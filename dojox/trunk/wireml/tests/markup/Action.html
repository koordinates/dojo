<html>
<head>
<title>Test Action</title>
<script type="text/javascript" src="../../../../dojo/dojo.js" djConfig="isDebug: true"></script>
<script type="text/javascript">
dojo.provide("dojox.wireml.tests.markup.Action");

dojo.require("dijit.util.parser");
dojo.require("doh.runner");
dojo.require("dojox.wireml.Action");
dojo.require("dojox.wireml.Transfer");

dojox.wireml.tests.markup.Action = {
	transfer: function(){},
	source: {a: "A", b: "B"}
};

dojo.addOnLoad(function(){
	doh.register("dojox.wireml.tests.markup.Action", [

		function test_Action_triggerEvent(t){
			dojox.wireml.tests.markup.Action.target = {};
			dojox.wireml.tests.markup.Action.transfer();
			t.assertEqual(dojox.wireml.tests.markup.Action.source.a, dojox.wireml.tests.markup.Action.target.a);
			t.assertEqual(dojox.wireml.tests.markup.Action.source.b, dojox.wireml.tests.markup.Action.target.b);
		},

		function test_Action_triggerTopic(t){
			dojox.wireml.tests.markup.Action.target = {};
			dojo.publish("transfer");
			t.assertEqual(dojox.wireml.tests.markup.Action.source.a, dojox.wireml.tests.markup.Action.target.a);
		},

		function test_ActionFilter_required(t){
			dojox.wireml.tests.markup.Action.target = {};
			dojo.publish("transferFilter");
			t.assertEqual(undefined, dojox.wireml.tests.markup.Action.target.a);
			t.assertEqual("no required", dojox.wireml.tests.markup.Action.error);
			dojox.wireml.tests.markup.Action.required = true;
			dojo.publish("transferFilter");
			t.assertEqual(dojox.wireml.tests.markup.Action.source.a, dojox.wireml.tests.markup.Action.target.a);
		}

	]);
	doh.run();
});
</script>
</head>
<body>
<div dojoType="dojox.wireml.Action"
	trigger="dojox.wireml.tests.markup.Action"
	triggerEvent="transfer">
	<div dojoType="dojox.wireml.Transfer"
		source="dojox.wireml.tests.markup.Action.source.a"
		target="dojox.wireml.tests.markup.Action.target.a"></div>
	<div dojoType="dojox.wireml.Transfer"
		source="dojox.wireml.tests.markup.Action.source.b"
		target="dojox.wireml.tests.markup.Action.target.b"></div>
</div>
<div dojoType="dojox.wireml.Action"
	triggerTopic="transfer">
	<div dojoType="dojox.wireml.Transfer"
		source="dojox.wireml.tests.markup.Action.source.a"
		target="dojox.wireml.tests.markup.Action.target.a"></div>
</div>
<div dojoType="dojox.wireml.Action"
	triggerTopic="transferFilter">
	<div dojoType="dojox.wireml.ActionFilter"
		required="dojox.wireml.tests.markup.Action.required"
		message="no required"
		error="dojox.wireml.tests.markup.Action.error"></div>
	<div dojoType="dojox.wireml.Transfer"
		source="dojox.wireml.tests.markup.Action.source.a"
		target="dojox.wireml.tests.markup.Action.target.a"></div>
</div>
</body>
</html>
