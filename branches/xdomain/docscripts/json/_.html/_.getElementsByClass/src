parent = dojo.byId(parent);
if(!parent){ parent = document; }
var classes = classStr.split(/\s+/g);
var nodes = [];
if( classMatchType != 1 && classMatchType != 2 ) classMatchType = 0;  make it enum
var reClass = new RegExp("(\\s|^)((" + classes.join(")|(") + "))(\\s|$)");

 FIXME: doesn't have correct parent support!
if(!nodeType){ nodeType = "*"; }
var candidateNodes = parent.getElementsByTagName(nodeType);

outer:
for(var i = 0; i < candidateNodes.length; i++) {
	var node = candidateNodes[i];
	var nodeClasses = dojo.html.getClasses(node);
	if(nodeClasses.length == 0) { continue outer; }
	var matches = 0;

	for(var j = 0; j < nodeClasses.length; j++) {
		if( reClass.test(nodeClasses[j]) ) {
			if( classMatchType == dojo.html.classMatchType.ContainsAny ) {
				nodes.push(node);
				continue outer;
			} else {
				matches++;
			}
		} else {
			if( classMatchType == dojo.html.classMatchType.IsOnly ) {
				continue outer;
			}
		}
	}

	if( matches == classes.length ) {
		if( classMatchType == dojo.html.classMatchType.IsOnly && matches == nodeClasses.length ) {
			nodes.push(node);
		} else if( classMatchType == dojo.html.classMatchType.ContainsAll ) {
			nodes.push(node);
		}
	}
}

return nodes;