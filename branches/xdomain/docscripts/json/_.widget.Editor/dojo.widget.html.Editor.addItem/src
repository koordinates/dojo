if(!tb) { tb = this._toolbars[0]; }
var cmd = ((item)&&(!dojo.lang.isUndefined(item["getValue"]))) ?  cmd = item["getValue"](): item;

var groups = dojo.widget.html.Editor.itemGroups;
if(item instanceof dojo.widget.ToolbarItem) {
	tb.addChild(item);
} else if(groups[cmd]) {
	var group = groups[cmd];
	var worked = true;
	if(cmd == "justifyGroup" || cmd == "listGroup") {
		var btnGroup = [cmd];
		for(var i = 0 ; i < group.length; i++) {
			if(dontValidate || this.isSupportedCommand(group[i])) {
				btnGroup.push(this.getCommandImage(group[i]));
			}else{
				worked = false;
			}
		}
		if(btnGroup.length) {
			var btn = tb.addChild(btnGroup, null, this.getItemProperties(cmd));
			dojo.event.connect(btn, "onClick", this, "_action");
			dojo.event.connect(btn, "onChangeSelect", this, "_action");
		}
		return worked;
	} else {
		for(var i = 0; i < group.length; i++) {
			if(!this.addItem(group[i], tb)){
				worked = false;
			}
		}
		return worked;
	}
} else {
	if((!dontValidate)&&(!this.isSupportedCommand(cmd))){
		return false;
	}
	if(dontValidate || this.isSupportedCommand(cmd)) {
		cmd = cmd.toLowerCase();
		if(cmd == "formatblock") {
			var select = dojo.widget.createWidget("ToolbarSelect", {
				name: "formatBlock",
				values: this.formatBlockItems
			});
			tb.addChild(select);
			var _this = this;
			dojo.event.connect(select, "onSetValue", function(item, value) {
				_this.onAction("formatBlock", value);
			});
		} else if(cmd == "fontname") {
			var select = dojo.widget.createWidget("ToolbarSelect", {
				name: "fontName",
				values: this.fontNameItems
			});
			tb.addChild(select);
			dojo.event.connect(select, "onSetValue", dojo.lang.hitch(this, function(item, value) {
				this.onAction("fontName", value);
			}));
		} else if(cmd == "fontsize") {
			var select = dojo.widget.createWidget("ToolbarSelect", {
				name: "fontSize",
				values: this.fontSizeItems
			});
			tb.addChild(select);
			dojo.event.connect(select, "onSetValue", dojo.lang.hitch(this, function(item, value) {
				this.onAction("fontSize", value);
			}));
		} else if(dojo.lang.inArray(cmd, ["forecolor", "hilitecolor"])) {
			var btn = tb.addChild(dojo.widget.createWidget("ToolbarColorDialog", this.getItemProperties(cmd)));
			dojo.event.connect(btn, "onSetValue", this, "_setValue");
		} else {
			var btn = tb.addChild(this.getCommandImage(cmd), null, this.getItemProperties(cmd));
			if(dojo.lang.inArray(cmd, ["save", "cancel"])) {
				dojo.event.connect(btn, "onClick", this, "_close");
			} else {
				dojo.event.connect(btn, "onClick", this, "_action");
				dojo.event.connect(btn, "onChangeSelect", this, "_action");
			}
		}
	}
}
return true;