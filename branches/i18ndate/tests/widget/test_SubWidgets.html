<html xmlns:dojo xmlns:myown>
<head>

<script type="text/javascript">
	var djConfig = {isDebug: true};
</script>
<script language="JavaScript" type="text/javascript" src="../../dojo.js"></script>

<script>
	dojo.require('dojo.namespace');
	dojo.require('dojo.widget.HtmlWidget');
	dojo.require("dojo.widget.TabContainer");
	dojo.require("dojo.widget.ContentPane");
	dojo.require("dojo.widget.Button");
	dojo.registerNamespace("myown", "myown");      // Get exception here if debugAtAllCosts set to true
</script>
</head>
<body>

<!-- TEST 1 -->

<!-- xmp is a very special element type - browser ignores all markup until it reaches /xmp tag -->
<!-- You might want to use a plain javascript string instead -->
<xmp id="Test1Template" style="display:none">
	<div>
		<div dojoAttachPoint="tabContainer" dojoType="dojo:TabContainer" doLayout="false">
			<div dojoAttachPoint="contentPane1" dojoType="dojo:ContentPane" label="pane 1">
				Pane 1
				<div dojoAttachPoint="testElement"></div>
			</div>
			<div dojoAttachPoint="contentPane2" dojoType="dojo:ContentPane" label="pane 2">
				Pane 2
			</div>
		</div>
	</div>
</xmp>

<!-- Declared in BODY so can refer to XMP elements. -->
<script>
	dojo.widget.defineWidget('myown.Test1', dojo.widget.HtmlWidget, {
		enableSubWidgets: true,
		isContainer: true,

		templateString: dojo.byId('Test1Template').textContent || dojo.byId('Test1Template').innerText,

		tabContainer: null,
		contentPane1: null,
		contentPane2: null,
		contentPane3: null,
		testElement: null,

		

		testSubWidgets1: function() {
			var strs = [];

			if (!this.tabContainer) {
				strs.push('tabContainer missing');
			} else if (this.tabContainer.constructor != dojo.widget.TabContainer) {
				strs.push('tabContainer is not a TabContainer');
			} else {
				if (this.tabContainer.contentPane1) {
					strs.push('this.tabContainer.contentPane1 exists and it shouldnt');
				}
				if (this.tabContainer.contentPane3) {
					strs.push('this.tabContainer.contentPane3 exists and it shouldnt?');
				}
			}

			if (!this.contentPane1) {
				strs.push('this.contentPane1 missing');
			} else if (this.contentPane1.constructor != dojo.widget.ContentPane) {
				strs.push('this.contentPane1 is not a ContentPane');
			} else if (!this.contentPane1._processedSubWidgets){
				strs.push('this.contentPane1._processedSubWidgets should be set!');
			}

			if (!this.contentPane2) {
				strs.push('this.contentPane2 missing');
			} else if (this.contentPane2.constructor != dojo.widget.ContentPane) {
				strs.push('this.contentPane2 is not a ContentPane');
			} else if (!this.contentPane2._processedSubWidgets){
				strs.push('this.contentPane2._processedSubWidgets should be set!');
			}

			if (this.contentPane3) {
				strs.push('this.contentPane3 exists and it shouldnt');
			}

			if (!this.testElement) {
				strs.push('testElement missing');
			} else if (this.testElement.tagName != 'DIV') {
				strs.push('testElement is not a DIV');
			}

			return strs;
		}
	});
</script>


<!-- can use widget immediately in markup - no parsing occurs until document loaded and scripts run -->
<myown:Test1 widgetId="test1Widget">
	<div id="contentPane3" dojoAttachPoint="contentPane3" dojoType="dojo:ContentPane" label="pane 3">
		Pane 3
	</div>
</myown:Test1>
^ Pane 3 ooops - In code how to set test1Widget.containerNode = test1Widget.tabContainer.containerNode <em>before</em> child nodes are added? Cannot do automagically because widget template may have multiple containers. Same issue with ButtonA missing below.

<script>
	function doTest1() {
		var strs = [];
		var test1Widget = dojo.widget.byId('test1Widget');
		if (!test1Widget) {
			strs.push('test1Widget not created');
		} else {
			strs = strs.concat(test1Widget.testSubWidgets1());
		}

		var contentPane3 = dojo.widget.byId("contentPane3");
		if (!contentPane3) {
			strs.push('contentPane3 missing');
		} else if (contentPane3.constructor != dojo.widget.ContentPane) {
			strs.push('contentPane3 is not a ContentPane');
		} else if (contentPane3._processedSubWidgets){
			strs.push('contentPane3._processedSubWidgets should NOT be set!');
		}

 		if(strs.length == 0){
			strs.push('all tests are passed!');
		}

		alert(strs.join('\n'));

	}
</script>
<br>
<button onClick="doTest1()">Run test 1</button>
<hr>




<!-- TEST 2 -->

<xmp id="Test2Template" style="display:none">
	<div>
		<div dojoType="myown:Test2"></div>
	</div>
</xmp>
<script>
	dojo.widget.defineWidget('myown.Test2', dojo.widget.HtmlWidget, {
		enableSubWidgets: true,
		isContainer: true,
		templateString: dojo.byId('Test2Template').textContent || dojo.byId('Test2Template').innerText
	});

	function doTest2() {
		var test2Widget = dojo.widget.createWidget('myown:Test2');
		alert('This alert shouldnt show?' + test2Widget);
	}
</script>
<br>
<br>
<br>
<br>
This test is recursive and hangs the browser or maybe even cause your PC problems:<br>
<button onClick="doTest2()">Run test 2</button>
<hr>




<!-- TEST 3 -->

<xmp id="Test3Template" style="display:none">
	<div>
		<div dojoAttachPoint="test1widget" dojoType="myown:Test1">
			<div dojoAttachPoint="buttonwidgetA" dojoType="dojo:Button">button A</div>
			<div dojoAttachPoint="testElement3"></div>
		</div>
		<dojo:Button dojoAttachPoint="buttonwidgetB">button B</dojo:Button>
	</div>
</xmp>

<script>
	dojo.widget.defineWidget('myown.Test3', dojo.widget.HtmlWidget, {
		enableSubWidgets: true,
		isContainer: true,

		templateString: dojo.byId('Test3Template').textContent || dojo.byId('Test3Template').innerText,

		// should be set
		test1widget: null,
		buttonwidgetA: null,
		buttonwidgetB: null,
		testElement3: null,

		// should not be set
		tabContainer: null,
		contentPane1: null,
		testElement: null,

		testSubWidgets3: function() {
			var strs = [];

			if (!this.test1widget) {
				strs.push('this.test1widget missing');
			} else if (this.test1widget.constructor != myown.Test1) {
				strs.push('this.test1widget is not a myown:Test1');
			}

			if (!this.buttonwidgetA) {
				strs.push('this.buttonwidgetA missing');
			} else if (this.buttonwidgetA.constructor != dojo.widget.Button) {
				strs.push('this.buttonwidgetA is not a Button');
			}

			if (!this.buttonwidgetB) {
				strs.push('this.buttonwidgetB missing');
			} else if (this.buttonwidgetB.constructor != dojo.widget.Button) {
				strs.push('this.buttonwidgetB is not a Button');
			}

			if (!this.testElement3) {
				strs.push('this.testElement3 missing');
			}

			if (this.tabContainer) {
				strs.push('this.tabContainer exists and it shouldnt');
			}

			if (this.contentPane1) {
				strs.push('this.contentPane1 exists and it shouldnt');
			}

			if (this.testElement) {
				strs.push('this.testElement exists and it shouldnt');
			}

			return strs;
		}
	});
</script>

<br>
<br>
<br>
<br>
<myown:Test3 widgetId="test3Widget">
</myown:Test3>

<script>
	function doTest3() {
		var strs = [];
		var test3Widget = dojo.widget.byId('test3Widget');
		if (!test3Widget) {
			strs.push('test3Widget not created');
		} else {
			strs = strs.concat(test3Widget.testSubWidgets3());
		}

 		if(strs.length == 0){
			strs.push('all tests are passed!');
		}

		alert(strs.join('\n'));

	}
</script>
<br>
<button onClick="doTest3()">Run test 3</button>
<br>
<hr>


</body>
</html>
