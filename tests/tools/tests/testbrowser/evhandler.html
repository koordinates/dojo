<html>
<head>
<script language="javascript">
alert("in head: document.documentElement=" + document.documentElement + " document.body=" + document.body);

var inited = false;

function myload() {
    if (inited) return;
    inited = true;
   alert("after onload: document.documentElement=" + document.documentElement + " document.body=" + document.body);
   window.onclick = function() {alert('window.onclick')};
   document.body.onclick = function() {alert('body.onclick')};
   document.onclick = function() {alert('document.onclick')};
   document.documentElement.onclick = function() {alert('documentElement.onclick')};
   add_handler(window, 'window', 'click', false);
   add_handler(document, 'document', 'click', false);
   add_handler(document.documentElement, 'documentElement', 'click', false);
   add_handler(document.documentElement, 'documentElement', 'click', true);
   add_handler(document.body, 'body', 'click', false);

   var evn = 'mouseover';
   var div1 = document.getElementById('test1');
   // exception on Mozilla, IE. simply does nothing in Opera and Safari
   //add_handler(div1, 'div1', evn, true, true);
   
   var div2 = document.getElementById('test2');
   var h2 = "var div2 = document.getElementById('test2'); var s = div2.getAttribute('on" + evn + "'); " +
   "alert('setAttribute string: ' + typeof div2.on" + evn + " + ' ' + typeof s)";
   alert(h2);
   div2.setAttribute('on' + evn, h2);

   var div3 = document.getElementById('test3');
   div3.setAttribute('on' + evn, function() {alert('setAttribute function')});

   var div4 = document.getElementById('test4');
   div4['on' + evn] = "alert('expando string: ' + typeof(document.getElementById('div4').on" + evn + ")";

   var div5 = document.getElementById('test5');
   div5['on' + evn] = function() {alert('expando function: ' + typeof(div5['on' + evn]) + ' ' + typeof(div5.getAttribute('on' + evn)) +
   div5.getAttribute('on' + evn)) };
}

function add_handler(obj, objname, evname, useCapture, as_string) {
   var desc;
   var func;
   if (obj.addEventListener) {
       desc = evname + " on " + objname + " via addEventListener with useCapture=" + useCapture;
       //alert("registering " + desc);
       desc = 'in: ' + desc;
       if (as_string) func = "alert('as string, " + desc + "')";
       if (!func) func = evname == 'load' ? function() {alert(desc); myload();} : function() {alert(desc)};
       obj.addEventListener(evname, func, useCapture);
   }
   else if (obj.attachEvent) {
       if (useCapture && !as_string) return; // don't do it again
       desc =  evname + " on " + objname + " via attachEvent";
       //alert("registering " + desc);
       desc = 'in: ' + desc;
       if (as_string) func = "alert('as string, " + desc + "')";
       if (!func) func = evname == 'load' ? function() {alert(desc); myload();} : function() {alert(desc)};
       obj.attachEvent('on' + evname, func);
   }
   else {alert("neither addEventListener nor attachEvent for " + objname);}
}

window.onload= function() {alert('window.onload'); myload()};
window.document.documentElement.onload= function() {alert('documentElement.onload'); myload()};
window.document.onload= function() {alert('document.onload'); myload()};

add_handler(window, 'window', 'load', false);
add_handler(window, 'window', 'load', true);
add_handler(document, 'document', 'load', false);
add_handler(document, 'document', 'load', true);
add_handler(document.documentElement, 'document.documentElement', 'load', false);
add_handler(document.documentElement, 'document.documentElement', 'load', true);

</script>
</head>
<body onload="alert('inline body onload'); myload()" onclick="alert('inline body onclick')">

<div id="test1">handler as string</div>

<div id="test2">setAttribute string</div>

<div id="test3">setAttribute function</div>

<div id="test4">expando string</div>

<div id="test5">expando function</div>

<hr>
<pre>
Results with no doctype....

IE5.5:
  in head: document.documentElement set, document.body==null
  onload is delivered to:
    window.onload or inline body.onload (latter winning)
    window.attachEvent
    NOT delivered to document or documentElement
  onclick is delivered to: 
    body.onclick
    body.attachEvent
    documentElement.onclick
    documentElement.attachEvent
    document.onclick
    document.attachEvent
    NOT: window.onclick, if body.onclick is set
    NOT: window.attachEvent
  setting a single handler:
    setAttribute function
    expando function
  getting a single handler:
    n.getAttribute is a function
    n.expando is a function

Mozilla:
  in head: document.documentElement set, document.body==null
  onload is delivered to:
    window.onload or inline body.onload (latter winning)
    window.addEventListener (in registration order, regardless of useCapture)
    NOT delivered to document or documentElement
  onclick is delivered to: 
    documentElement.addEventListener(useCapture=true)
    body.onclick
    body.addEventListener(false)
    documentElement.onclick
    documentElement.addEventListener(false)
    document.onclick
    document.addEventListener(false)
    window.onclick [even if body.onclick is set]
    window.addEventListener(false)
  setting a single handler:
    setAttribute string
    expando function
  getting a single handler:
    n.getAttribute is string, if any. (null if set via expando function)
    n.expando is function (set via either setAttribute string or expando function)

Opera:
  in head: document.documentElement set, document.body==undefined
  onload is delivered to:
    document.addEventListener(true)
    documentElement.addEventListener(true)
    inline body.onload
    document.onload
    window.attachEvent
    document.addEventListener(false)
    NOT: documentElement.addEventListener(false) [bug?]
    NOT: window.onload
  onclick is delivered to: 
    documentElement.addEventListener(useCapture=true)
    body.onclick
    body.addEventListener(false)
    documentElement.onclick
    documentElement.addEventListener(false)
    document.onclick
    window.attachEvent
    document.addEventListener(false)
    NOT: window.onclick, if body.onclick is set
  setting a single handler:
    setAttribute string
    expando string
    expando function
  getting a single handler:
    n.getAttribute is string, if any. (empty string if set via expando function)
    n.expando is function (set via either setAttribute string or expando function)

Safari:
  in head: document.documentElement set, document.body==null
  onload is delivered to:
    document.addEventListener(useCapture=true)
    documentElement.addEventListener(true)
    window.addEventListener(false)
    window.addEventListener(true) [bug?]
    inline body onload
  onclick is delivered to:
    documentElement.addEventListener(useCapture=true)
    body.addEventListener(false)
    documentElement.addEventListener(false)
    document.addEventListener(false)
    window.addEventListener(false)
    body.onclick
    documentElement.onclick
    document.onclick
    window.onclick [even if body.onclick is set]
  setting a single handler:
    setAttribute string
    expando function
  getting a single handler:
    n.getAttribute is string, if any. (null if set via expando function)
    n.expando is function (set via either setAttribute string or expando function)

Conclusions:
  onload:
    IE:      window.attachEvent [after]
    Mozilla: window.addEventListener [useCapture irrelevant; after]
    Opera:   document.addEventListener(true) [before] or window.attachEvent [middle] or document.addEventListener(false) [after]
    Safari:  window.addEventListener [useCapture irrelevant; before]
  onclick (prefering latest/highest possible):
    Mozilla: window.addEventListener(false) [after; document also works]
    IE:      document.attachEvent [after]
    Opera:   document.addEventListener(false) [after]
    Safari:  window.addEventListener(false) [before; document also works]
  setting a single handler:
    IE:      must be a function, whether setAttribute or expando
    else:    use setAttribute for string, expando for function.
  getting a handler:
    n.expando always works if you want a function
    n.getAttribute returns a string, but it is null or empty string if originally set via expando function
</pre>    
</body>
</html>
