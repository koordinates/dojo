<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
		"http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
	<title>doh.robot ComboBox Test</title>

	<style>
		@import "../../../../util/doh/robot/robot.css";
	</style>

	<!-- required: dojo.js -->
	<script type="text/javascript" src="../../../../dojo/dojo.js"
		djConfig="isDebug: true, parseOnLoad: true"></script>
	<script type="text/javascript">
		dojo.require("dijit.dijit"); // optimize: load dijit layer
		dojo.require("dijit.robotx");

		dojo.addOnLoad(function(){
			var start;
			var textbox;
			var datatestDijit;
			doh.robot.initRobot('../test_ComboBox.html');
			doh.register("dijit.form.ComboBox",
				{
					timeout:11000,
					name:"Tab",
					setUp:function(){
						// get the widgets from the robotURL window
						start = dijit.byId('setvaluetest');
						textbox = dijit.byId('datatest').focusNode;
						datatestDijit = dijit.byId('datatestDijit').focusNode;
						dijit.byId('datatestDijit').attr("value", "");
					},
					runTest: function(){
						var d = new doh.Deferred();
						doh.robot.mouseMoveAt(start.focusNode, 500);
						doh.robot.mouseClick({left:true}, 500);
						doh.robot.keyPress(dojo.keys.TAB, 500);
						doh.robot.keyPress(dojo.keys.TAB, 500);
						// tabbed to datatestDijit; type dijit.Ed

						doh.robot.typeKeys('dijit.Ed', 500, 4000);

						doh.robot.sequence(function(){
							if(/dijit\.Ed.+/.test(datatestDijit.value)){
								if(datatestDijit.value=="dijit.Editor"){
									d.callback(true);
								}else{
									d.errback(new Error("we got a failure"));
								}
							}else{
								d.errback(new Error("we got a failure"));
							}
						}, 3500);
						return d;
					}
				}
			);
			doh.register("dijit.form.ComboBox",
				{
					timeout:8000,
					name:"SimpleClick",
					setUp:function(){
						dijit.byId('datatest').attr("value", "");
					},
					runTest: function(){
						var d = new doh.Deferred();
						doh.robot.keyPress(dojo.keys.ENTER);
						// let's try mouse click
						doh.robot.mouseMoveAt(textbox, 500);
						doh.robot.mouseClick({left:true}, 500);
						doh.robot.typeKeys('Col', 500, 1500);
						doh.robot.sequence(function(){
							if(/Col.+/.test(textbox.value)){
								if(textbox.value=="Colorado"&&datatestDijit.value=="dijit.Editor"){
									// close ComboBox menu
									doh.robot.keyPress(dojo.keys.ENTER);
									d.callback(true);

								}else{
									d.errback(new Error("we got a failure"));
								}
							}else{
								d.errback(new Error("we got a failure"));
							}
						}, 4000);
						return d;
					}
				}
			);

			doh.register("dijit.form.ComboBox",
				{
					timeout:6000,
					name:"MenuClick",
					runTest: function(){
						var d = new doh.Deferred();
						doh.robot.mouseMoveAt(start.downArrowNode, 500);
						doh.robot.mouseClick({left:true}, 500);
						// first menu: click More Choices
						doh.robot.mouseMoveAt("setvaluetest_popup_next", 500);
						doh.robot.mouseClick({left:true}, 500);
						// second menu: click Mississippi
						doh.robot.mouseMoveAt("setvaluetest_popup1", 500);
						doh.robot.mouseClick({left:true}, 500);
						doh.robot.sequence(function(){
							if(start.attr('value')=="Mississippi"){
								d.callback(true);
							}else{
								d.errback("Wrong menu item selected");
							}
						}, 1000);
						return d;
					}
				}
			);
			doh.run();
		});
	</script>
</head>
</html>
