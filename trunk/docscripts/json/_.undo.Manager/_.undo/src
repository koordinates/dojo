if(!this.canUndo) { return false; }

this.endAllTransactions();

this.isUndoing = true;
var top = this._undoStack.pop();
if(top instanceof this.constructor) {
	top.undoAll();
} else {
	top.undo();
}
if(top.redo) {
	this._redoStack.push(top);
}
this.isUndoing = false;

this._updateStatus();
this.onUndo(this, top);
if(!(top instanceof this.constructor)) {
	this.getTop().onUndoAny(this, top);
}
return true;