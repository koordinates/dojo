if (child.widgetType != 'TreeNode'){
	dojo.raise("You can only add TreeNode widgets to a "+this.widgetType+" widget!");
	return;
}

if (this.children.length){

	var lastChild = this.children[this.children.length-1];
	lastChild.isLastNode = false;
	lastChild.updateIconTree();
}else{

	if (this.widgetType == 'TreeNode'){
		this.isParent = true;
		this.isExpanded = false;
		this.updateIcons();
	}

	child.isFirstNode = true;
}

if (this.widgetType == 'TreeNode'){

	var childDepth = this.depth+1;
	var childTree = this.tree;

	child.parentNode = this;
	child.isLastNode = true;

}else{
	var childDepth = 0;
	var childTree = this;

	child.isLastNode = true;
}

this.children.push(child);
var node = child.buildNode(childTree, childDepth);

if (this.widgetType == 'Tree'){
	this.domNode.appendChild(node);
}else{
	this.containerNode.appendChild(node);
}

child.startMe();