if(!dojo.lang.isString(str)) { return str; }
var ret = "";
var value = escape(str);
var match, re = /%u([0-9A-F]{4})/i;
while((match = value.match(re))) {
	var num = Number("0x"+match[1]);
	var newVal = escape("&#" + num + ";");
	ret += value.substring(0, match.index) + newVal;
	value = value.substring(match.index+match[0].length);
}
ret += value.replace(/\+/g, "%2B");
return ret;