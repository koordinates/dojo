<script>
_container_.addOnLoad(function(){
	if(!_container_.refreshOnShow){
		dojo.event.connect(_container_, "show", this, "init");
	}
	this.init();
});

this.editableAttributes = ['href', 'target', 'class'];
this.init = function(){
	var curInst = dojo.widget.Editor2Manager.getCurrentInstance();

	this.linkNode = dojo.withGlobal(curInst.window, "getAncestorElement", dojo.html.selection, ['a']);
	var linkAttributes = {};
	this.extraAttribText = "";
	if(this.linkNode){
		var attrs = this.linkNode.attributes;
		for(var i=0; i<attrs.length; i++) {
			if(dojo.lang.find(this.editableAttributes, attrs[i].name.toLowerCase())>-1){
				linkAttributes[attrs[i].name] = attrs[i].value;
			}else{
				//IE lists all attributes, even default ones, filter them
				if(attrs[i].specified == undefined || attrs[i].specified){
					this.extraAttribText += attrs[i].name + '="'+attrs[i].value+'" ';
				}
			}
		}
	}else{
		var html = dojo.withGlobal(curInst.window, "getSelectedText", dojo.html.selection);
		if(html == null || html.length == 0){
			alert("Please select some text to create a link.");
			this.cancel();
		}
	}

	for(var i in this.editableAttributes){
		name = this.editableAttributes[i];
		dojo.byId("dojo_createLink_"+name).value = (linkAttributes[name] == undefined) ? "" : linkAttributes[name] ;
	}
}

this.ok = function(){
	var curInst = dojo.widget.Editor2Manager.getCurrentInstance();
	if(!this.linkNode){
		var html = dojo.withGlobal(curInst.window, "getSelectedText", dojo.html.selection);
	}else{
		var html = this.linkNode.innerHTML;
		dojo.withGlobal(curInst.window, "selectElement", dojo.html.selection, [this.linkNode]);
	}

	var attstr='';
	for(var i in this.editableAttributes){
		name = this.editableAttributes[i];
		var value = dojo.byId("dojo_createLink_"+name).value;
		if(value.length > 0){
			attstr += name + '="'+value+'" ';
		}
	}
	curInst.execCommand('inserthtml', '<a '+attstr+this.extraAttribText+'>'+html+'</a>');

	this.cancel();
}
this.cancel = function(){
	_container_.hide();
}
</script>
<table>
<tr><td>URL</td><td> <input type="text" id="dojo_createLink_href" name="dojo_createLink_href"/></td></tr>
<tr><td>Target </td><td><select id="dojo_createLink_target">
	<option value="">Self</option>
	<option value="_blank">New Window</option>
	<option value="_top">Top Window</option>
	</select></td></tr>
<tr><td>Class </td><td><input type="text" id="dojo_createLink_class" /></td></tr>
</table>
<table><tr>
<td><button dojoType='Button' onClick='scriptScope.ok();'>OK</button></td>
<td><button dojoType='Button' onClick='scriptScope.cancel();'>Cancel</button></td>
</tr></table>